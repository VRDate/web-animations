<!DOCTYPE html>
<html>
  <head>
    <title>Web Animations 1.0</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js'
      class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use
          // ED.
          specStatus: "unofficial",

          // the specification's short name, as in
          // http://www.w3.org/TR/short-name/
          // shortName:            "web-anim",

          // if your specification has a subtitle that goes below the main
          // formal title, define it here
          // subtitle   :  "an excellent document",

          // if you wish the publication date to be other than today, set this
          // publishDate:  "2009-08-06",

          // if the specification's copyright date is a range of years, specify
          // the start date here:
          // copyrightStart: "2005"

          // if there is a previously published draft, uncomment this and set
          // its YYYY-MM-DD date and its maturity status
          // previousPublishDate: "1977-03-15",
          // previousMaturity: "WD",

          // if there a publicly available Editor's Draft, this is the link
          // edDraftURI:
          // "http://dev.w3.org/2009/dap/ReSpec.js/documentation.html",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",

          // if you want to have extra CSS, append them to this list
          // it is recommended that the respec.css stylesheet be kept
          extraCSS: ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css",
                     "web-animations.css"],

          // Turning off inlineCSS for now since if extraCSS points to
          // a relative URL your testing from a file URL the XHR will fail.
          // Probably should turn this back on once this is hosted on a server
          // somewhere.
          inlineCSS: false,

          // editors, add as many as you like
          // only "name" is required
          // XXX I've only put this in because the template requires it. I'm not
          // sure how important the order is but for now I've done it in
          // alphabetical order
          editors:  [
              { name: "Brian Birtles", mailto: "bbirtles@mozilla.com",
                company: "Mozilla", companyURL: "http://mozilla.org/" },
              { name: "Rik Cabanier", mailto: "cabanier@adobe.com",
                company: "Adobe Systems", companyURL: "http://www.adobe.com/" },
              { name: "Alex Danilo", mailto: "adanilo@google.com",
                company: "Google, Inc", companyURL: "http://www.google.com/" },
              { name: "Shane Stephens", mailto: "shans@google.com",
                company: "Google, Inc", companyURL: "http://www.google.com/" },
          ],

          // authors, add as many as you like.
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],

          // XXX If we continue using ReSpec then we need to tweak it to support
          // multiple working groups. It includes updating the patent section
          // prose to say "groups" instead of "group" etc.
          // name of the WG
          // wg: "CSS Working Group (part of the Style Activity) and the SVG " +
          //     "Working Group (part of the Graphics Activity)",

          // URI of the public WG page
          // wgURI: "http://www.w3.org/Graphics/fx/",

          // name (without the @w3c.org) of the public mailing to which comments
          // are due
          wgPublicList: "public-fx",

          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI
          // from a random document unless you know what you're doing. If in
          // doubt ask your friendly neighbourhood Team Contact.
          wgPatentURI:  "",

          noIDLSorting: true,
          noIDLIn: true
      };
    </script>
    <!--
      ReSpec.js wishlist:

      Add here any issues you find with ReSpec including missing features. It
      will help us decide if we should continue using it and work out what we
      need to fix.

      * Need ability to cross-reference members of interfaces (e.g. constants
        etc.)
    -->
  </head>
  <body>
    <section id='abstract'>
      This is the abstract for your specification.
    </section>

    <section>
      <h2>Introduction</h2>
      <p>
        Your text...
      </p>
      <section>
        <h3>Relationship to other specifications</h3>
        <p>
          CSS Transitions, CSS Animations, SVG, SMIL
        </p>
      </section>
    </section>

    <section class="informative">
      <h2>The animation timeline</h2>
      <p>
        Each document contains a timeline to which animations may be added. Each
        animation has a start time which determines when the animation becomes
        active. After the animation is finished, the animation will become
        inactive unless it is defined to sustain its effect indefinitely (see
        <a href="#animation-fill-behavior" class="sectionRef"></a>).
      </p>
      <div class="figure">
        <object data="img/timeline.svg" width="600"></object>
      </div>
      <p class="caption">
        At time <em>t</em> animations A and B are active. Animation C has
        already completed and is now inactive. Animation D has yet to begin and
        is also inactive.
      </p>
      <p class="todo">
        End-point exclusive timing&mdash;this probably belongs in the timed item
        section.
      </p>
      <p class="todo">
        Define when the timeline starts&mdash;is it document load, or can it
        start beforehand?
      </p>
    </section>

    <section>
      <h2>Animations in the timeline</h2>
      <p>
        Animations in the timeline are represented by
        <code>WebAnimation</code> objects.
      </p>
      <section>
        <h3>The <code>WebAnimation</code> interface</h3>
        <p>
          All the stuff in the WebTimedItem interface here should be
          a snapshot of what was in the <code>WebAnimationTemplate</code> from
          which this object was minted. That's not to say it's readonly though.
          <dl title="interface WebAnimation : WebTimedItem" class="idl">
            <dt>readonly attribute WebAnimationFunctionCollection functions</dt>
            <dd>
              A readonly snapshot of the animation functions copied from
              <code>template</code>, one per target property / attribute. As
              with the <code>WebAnimationTemplate</code> interface, in
              ECMAScript you can just do <code>functions["height"]</code>.
            </dd>
            <dt>readonly attribute WebAnimationTemplate template</dt>
            <dd>
              The <code>WebAnimationTemplate</code> object from which this
              object was minted.
            </dd>
            <dt>readonly attribute Element targetElement</dt>
            <dd>
              The element being animated by this object. Can this be null?
              Presumably yes? i.e. this isn't an owning reference?
            </dd>
          </dl>
        </p>
        <p>
          Describe liveness (what can you change when)
        </p>
      </section>
    </section>

    <section>
      <h2>Creating animations</h2>
      <p>
        <code>WebAnimation</code> objects are not created directly, but via
        a separate <code>WebAnimationTemplate</code> object. The
        <code>WebAnimationTemplate</code> object acts a cookie-cutter allowing
        the same set of animation parameters to be used multiple times with
        multiple target elements.
      </p>
      <p>
        The <code>WebAnimation</code> objects created by the
        <code>animate</code> method of a <code>WebAnimationTemplate</code>
        do not share data with the <code>WebAnimationTemplate</code> object from
        which they were minted or with other <code>WebAnimation</code> objects
        created from the same <code>WebAnimationTemplate</code>. Their
        properties are independent and unique copies such that comparing their
        object identities will return false.
      </p>
      <section>
        <h3>The <code>WebAnimationTemplate</code> interface</h3>
        <p>
          <dl title="[Constructor] interface WebAnimationTemplate" class="idl">
            <dt>attribute unrestricted float? specifiedDuration</dt>
            <dd>
              See the description on the WebTimedItem interface.
            </dd>
            <dt>attribute float iterationCount</dt>
            <dd>
              See the description on the WebTimedItem interface.
            </dd>
            <dt>attribute unsigned short direction/reversing</dt>
            <dd>
              See the description on the WebTimedItem interface.
            </dd>
            <dt>attribute float startDelay</dt>
            <dd>
              See the description on the WebTimedItem interface.
            </dd>
            <dt>attribute WebTimingFunction timingFunction</dt>
            <dd>
              See the description on the webTimedItem interface.
            </dd>
            <dt>attribute WebAnimationFunctionCollection functions</dt>
            <dd>
              A series of animation functions, one per target property
              / attribute. As with <code>HTMLCollection</code>, in ECMAScript
              you should be able to just use <code>functions["height"]</code> to
              get the appropriate function (rather than
              <code>functions.nameItem("height")</code>).
            </dd>
            <dt>sequence&lt;webanimation&gt; animate (any target,
              optional float startTime)</dt>
            <dd>
              <p>
                Creates a series of <code>WebAnimation</code> objects, one for
                each element in <code>target</code>. For each
                <code>element</code> in <code>target</code> the associated
                animation is appended to the animation group corresponding to
                <code>element.ownerDocument.animationRoot</code>.
              </p>
              <p>
                <code>target</code> may be one of the following types:
                <code>Element</code>, <code>NodeList</code>,
                <code>Element[]</code>. If <code>target</code> is of type
                <code>NodeList</code> all nodes in the list that are not of type
                <code>ELEMENT_NODE</code> are ignored.
              </p>
              <p>
                <code>startTime</code> represents a time in the context of the
                <code>WebAnimationGroup</code> to which it is appended. If this
                parameter is not specified it will default to the current time
                of the animation group to which it is appended.
              </p>
              <p>
                The <code>WebAnimation</code> objects created by this method
                behave independently of this object as described in <a
                  href="#creating-animations" class="sectionRef"></a>.
              </p>
            </dd>
            <dt>sequence&lt;webanimation&gt; animateWithParent (any target,
              WebAnimationGroup? parentGroup, optional float startTime)</dt>
            <dd>
              <p>
                Similar to <code>animate</code>, this method creates one
                <code>WebAnimation</code> objects for each element in
                <code>target</code> but then appends the resulting
                <code>WebAnimation</code> objects as children of the given
                <code>parentGroup</code>, if provided. If
                <code>parentGroup</code> is null, the <code>WebAnimation</code>
                objects will not be added to any group.
              </p>
              <p>
                The handling of <code>target</code> is the same as for
                <code>animate</code>.
              </p>
              <p>
                <code>startTime</code> represents a time in the context of the
                <code>WebAnimationGroup</code> to which it will be appended. In
                this case that <code>parentGroup</code> is not null, this will
                be <code>parentGroup</code>.
                If this parameter is not specified it will default to the
                current time of <code>parentGroup</code> if it is not null,
                otherwise it will default to 0.
              </p>
            </dd>
          </dl>
          <div class="feedbackWanted">
            <p>
              The requirements for the <code>animate</code> is as follows.
              Regarding the animation target(s) we want to support:
            </p>
            <pre>
              template.animate(document.getElementById("a"));
              template.animate(document.querySelectorAll("div.warning"));</pre>
            <p>
              That is we want to support at least:
            </p>
            <ul>
              <li>Element</li>
              <li>NodeList (for <code>querySelectorAll</code>,
              <code>getElementsByTagName</code>, <code>Node.childNodes</code>
              etc.)</li>
            </ul>
            <p>
              It would be nice to also support an array of Elements.
            </p>
            <p>
              Regarding start time, it is necessary to be able to specify it.
              However, it is probably very useful to have a default behaviour
              that uses the current time of the container. That is, ideally this
              parameter should be optional.
            </p>
            <p>
              Regarding the parent animation group, there are three possible
              scenarios we probably want to support:
            </p>
            <ul>
              <li>Specify an explicit parent group</li>
              <li>Use the default animation group (<code>animationRoot</code>)
              of the element's <code>ownerDocument</code></li>
              <li>Have no parent group (This is particularly important
              animations destined for sequential animation groups containers
              where the order of children is important and so you might want to
              insert the animation yourself at a particular position. It's also
              likely there will be situations where you want to make the
              animation and attach it later such as a helper function that
              returns an animation object for the caller to insert.)</li>
            </ul>
            <p>
              That gives you up to 18 permutations of ways of calling
              <code>animate</code>. At the same time, we want
              <code>animate</code> to be as simple to use as possible. The above
              interface is an attempt to balance these requirements. It depends
              on WebIDL and ECMAScript either being able to do overloading by
              parameter type or accepting an "any" type and then checking the
              type of the argument. I'm not sure what the best way is to do
              this.
            </p>
          </div>
        </p>
      </section>
    </section>

    <section>
      <h2>Timing animations</h2>
      <p>
        Explanation about timing stuff, active time, simple time etc.
      </p>
      <section class="informative">
        <h3>Animation phases</h3>
        <p>
          An individual animation can be in one of four possible states, called
          phases:
        </p>
        <dl>
          <dt>Inactive</dt>
          <dd>The animation has yet to start or has already finished. It has no
          effect on its target.</dd>
          <dt>Delayed (active)</dt>
          <dd>The animation is waiting to start (assuming time is progressing
          forwards). Depending on the animation's fill mode, it may apply
          a backwards fill to its target at this time.</dd>
          <dt>Animating (active)</dt>
          <dd>The animation is executing, and will apply its effect to its
          target.</dd>
          <dt>Filling (active)</dt>
          <dd>The animation has finished but continues to apply its final value
          to the target element. The animation will only enter this phase if its
          fill mode produces a forwards fill.</dd>
        </dl>
        <p>
          At a more general level, if the animation is in any phase other than
          <i>inactive</i>, it is said to be <i>active</i> even though it may not
          be <i>animating</i>.
        </p>
        <p>
          These phases can be visualized as follows:
        </p>
        <div class="figure">
          <object data="img/animation-phases.svg" width="600"></object>
        </div>
        <p class="caption">
          Animation phases.
        </p>
        <p>
          Depending on the an animation's properties, it may not enter all of
          these phases. Following are some common patterns of animations phases.
        </p>
        <div class="figure">
          <object data="img/animation-phase-examples.svg" width="600"></object>
        </div>
        <p class="caption">
          Common animation patterns.<br>
          (a) An animation without delay or forwards fill<br>
          (b) An animation with forwards fill<br>
          (c) An animation with cancelled forwards fill<br>
          (c) An animation with delay only (no forwards fill)<br>
        </p>
      </section>
      <section>
        <h3>Simple time and animation time</h3>
        <p>
          Need to describe the following:
        </p>
        <div class="figure">
          <object data="img/simple-and-animation-time.svg" width="600"></object>
        </div>
        <p class="caption">
          A comparison of simple and animation time for an animation with
          a simple duration of 1s and an iteration count of 2.5.
        </p>
        <p>
          Things to point out:
        </p>
        <ul>
          <li>Animation time is only defined while its animating</li>
          <li>Simple time is defined while the animation is affecting the
              target</li>
          <li>End-point exclusive timing at the repetition boundaries</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the simple duration</h3>
        <p>
          Need to talk about intrinsic duration
        </p>
        <p>
          If we support <code>pace="10px/s"</code> this is where it would go.
        </p>
      </section>
      <section>
        <h3>Calculating the animation duration</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Multiplying the simple duration by the iteration count</li>
          <li>Apply min and max (if they are supported)</li>
          <li>Applying any speed functions&mdash;or do they apply directly to
              the simple duration?</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the item time</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Get the <var>simple time</var> from the parent group</li>
          <li>Subtract the <var>start time</var></li>
          <li>Subtract pause offsets
            <ul>
              <li>Basically, you subtract the duration of completed pause
              intervals.</li>
              <li>If we're in the middle of a pause interval, you subtract the
              amount of paused time. The maths for this depends on if we store
              pause endpoints in parent time (not good if you move stuff around
              in the tree), or offsets from the start time + a duration
              (probably better).</li>
            </ul>
          </li>
          <li>Work out if we're in range (i.e. calculate end time)</li>
          <li>Return the resulting time</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the animation time</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Get the <var>item time</var> as described above</li>
          <li>Subtract the <var>start delay</var></li>
          <li>If it's negative, we're not animating, return
              <code>null</code>.</li>
          <li>If the time is greater than the animation duration, we're not
              animating, return <code>null</code>.</li>
          <li>Return the resulting time</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the simple time</h3>
        <p class="note">
          We don't need to be concerned about pause times here, they will be
          taken care of when we calculate the item time (see <a
            href="#calculating-the-item-time" class="sectionRef"></a>).
        </p>
        <p>
          The simple time is calculated by first converting the <var>animation
          time</var> down into intervals. This is called the <var>unscaled
          simple time</var>. Following this, timing manipulations specified on
          the timed item are applied to the <var>unscaled simple time</var> to
          produce the <var>simple time</var>.
        </p>
        <section>
          <h4>Calculating the unscaled simple time</h4>
          <p>
            The <var>unscaled simple time</var> is calculated according to the
            following steps:
          </p>
          <ol>
            <li>
              If the <var>item time</var> is null (i.e. the animation is
              inactive), return <code>null</code>.
            </li>
            <li>
              If <var>item time</var> &lt; <var>start delay</var> (i.e. the
              animation is delayed), then
              <dl class="switch">
                <dt>
                  If the item has fill mode that produces a backwards fill,
                </dt>
                <dd>return zero.</dd>
                <dt>
                  Otherwise,
                </dt>
                <dd>return <code>null</code>.</dd>
              </dl>
            </li>
            <li>
              If the simple duration is infinite, return zero.
            </li>
            <li>
              If the simple duration is zero, return the <var>simple
              duration</var>.
            </li>
            <li>
              If <var>animation time</var> is not <code>null</code> (i.e. the
              animation is animating), return <code><var>animation time</var>
              % <var>simple duration</var></code>.
            </li>
            <li>
              If the <var>animation duration</var> is a positive multiple of the
              <var>simple duration</var>, return the <var>simple duration</var>.
            </li>
            <li>
              Otherwise, return <code><var>animation duration</var>
              % <var>simple duration</var></code>.
            </li>
          </ol>
        </section>
        <section>
          <h4>Applying time manipulations</h4>
          <p>
            The <var>unscaled simple time</var> is converted into the
            <var>simple time</var> using the following steps:
          <ol>
            <li>
              If the <var>unscaled simple time</var> is <code>null</code>,
              return <code>null</code>.
            </li>
            <li>
              Let <var>scaled simple time</var> be the result of applying any
              timing function defined for this timed element to the
              <var>unscaled simple time</var>. <span class="todo">(Need more
              detail here, or a link to where this is defined.)</span>
            </li>
            <li>
              Calculate the <var>current direction</var> using the first
              matching condition from the following list:
              <dl class="switch">
                <dt>
                  If the direction is normal,
                </dt>
                <dd>Let the <var>current direction</var> be forwards.</dd>
                <dt>
                  If the direction is reverse,
                </dt>
                <dd>Let the <var>current direction</var> be reverse.</dd>
                <dt>
                  Otherwise,
                </dt>
                <dd>
                  <ol>
                    <li>
                      Let <var>d</var> be the <var>current iteration</var> (see
                      <a href="#calculating-the-current-iteration"
                        class="sectionRef"></a>.
                    </li>
                    <li>
                      If the direction is alternate-reverse increment
                      <var>d</var> by 1.
                    </li>
                    <li>
                      If the animation is not animating, and the
                      <var>animation duration</var> is a positive multiple of
                      the <var>simple duration</var> increment <var>d</var> by
                      1.
                    </li>
                    <li>
                      If <code><var>d</var> % 2 != 0</code>, let the
                      <var>current direction</var> be forwards, otherwise let
                      the <var>current direction</var> be reverse.
                    </li>
                  </ol>
                </dd>
              </dl>
            </li>
            <li>
              If the <var>current direction</var> is forwards then return
              the <var>scaled simple time</var>.
              <p>
                Otherwise, return the <var>simple duration</var> - <var>scaled 
                simple time</var>.
              </p>
            </li>
          </ol>
          <p class="note">
            Applying the reverse behaviour after the timing function means that
            ease-in becomes ease-out on reverse, however it avoids jumps in
            values when reversing part-way.
          </p>
        </section>
        <section>
          <h4>Calculating the current iteration</h4>
          <p>
            The <var>current iteration</var> can be calculated from the
            following steps:
          </p>
          <ol>
            <li>
              If the <var>item time</var> is <code>null</code>, return
              <code>null</code>.
            </li>
            <li>
              If the <code><var>item time</var> &lt; <var>start
              delay</var></code>, return zero.
            </li>
            <li>
              If the <var>simple duration</var> is zero, return
              <code>floor(<var>iteration count</var>)</code>.
            </li>
            <li>
              If <var>animation time</var> is not <code>null</code>, let
              <var>t</var> be the <var>animation time</var>, otherwise, let
              <var>t</var> be the <var>animation duration</var>.
            </li>
            <li>
              Return <code>floor(<var>t</var> / <var>simple
              duration</var>)</code>.
              <p class="note">
                If the <var>simple duration</var> is infinite, the
                result of <code>floor(<var>t</var> / <var>simple
                duration</var>)</code> will be zero as defined by IEEE 754.
              </p>
            </li>
          </ol>
        </section>
      </section>
      <section>
        <h3>Seeking a timed item</h3>
        <p>
          It might make sense to describe the behaviour for an animation first,
          and then for an animation group.
        </p>
        <p>
          Talk about how animations are not removed on a backwards seek so you
          need to remove them yourself or detect them and not re-create them.
          Perhaps we will have a seek event for this? Or a way of marking
          animations as remove-on-seek (which would remove the animation if you
          do a backwards seek past its startTime).
        </p>
        <p>
          Talk about the 5-minute rule plus issues relating to not chewing up
          more-and-more memory.
        </p>
        <p>
          Once an animation has become inactive, ideally all you need to store
          is:
        </p>
        <ul>
          <li>start time</li>
          <li>pause intervals</li>
          <li>end time (it might have been cancelled so you can just calculate
              this)</li>
          <li>target element</li>
          <li>parent time container</li>
          <li>pointer to animation template (unless data has changed on the
          template since this was made in which case you need to store the
          modifications)</li>
        </ul>
        <p>
          However, we have this idea that animations copy their shared data from
          their template when they are created (or is it when they become
          active?) So, if the template was changed, we should preserve the
          changed information too.
        </p>
        <p>
          Need to talk about what happens with regards to events too.
        </p>
      </section>
      <section>
        <h3>The <code>WebTimedItem</code> interface</h3>
        <p>
          Represents the timing properties and methods of an element in the
          timeline: either a <a>WebAnimation</a> or
          a <a>WebAnimationGroup</a>.
        </p>
        <dl title="interface WebTimedItem" class="idl">
          <dt>const unsigned short WEBA_FILL_NONE = 0</dt>
          <dd>
            No fill
          </dd>
          <dt>const unsigned short WEBA_FILL_FORWARDS = 1</dt>
          <dd>
            Fill forwards (=<code>fill="freeze"</code> in SVG speak)
          </dd>
          <dt>const unsigned short WEBA_FILL_BACKWARDS = 2</dt>
          <dd>
            Fill backwards
          </dd>
          <dt>const unsigned short WEBA_FILL_FORWARDS = 3</dt>
          <dd>
            Fill backwards and forwards
          </dd>
          <dt>attribute unrestricted float? specifiedDuration</dt>
          <dd>
            The duration specified for a single iteration. This may be
            <code>null</code> in which case the intrinsic duration will be used.
            The duration in seconds of a single iteration. If set, it must be
            greater than or equal to zero (including positive infinity).
          </dd>
          <dt>readonly attribute unrestricted float simpleDuration</dt>
          <dd>
            The simple duration calculated for this item. If
            <code>specifiedDuration</code> is set and greater the or equal to
            zero, this will match <code>specifiedDuration</code>. Otherwise,
            this will reflect the calculated intrinsic duration of the item as
            described in <a href="#calculating-the-simple-duration"
              class="sectionRef"></a>.
          </dd>
          <dt>readonly attribute float? animationDuration</dt>
          <dd>
            The amount of time in seconds the animation is schedule to animate
            as described in <a href="#calculating-the-animation-duration"
              class="sectionRef"></a>.
          </dd>
          <dt>readonly attribute float iterationCount</dt>
          <dd>
            A real number greater than or equal to 0 representing the number
            of times to repeat the animation.
          </dd>
          <dt>readonly attribute unsigned long? currentIteration</dt>
          <dd>
            The number of iterations that have completed as described in <a
              href="#calculating-the-current-iteration" class="sectionRef"></a>.
          </dd>
          <dt>attribute unsigned short direction/reversing</dt>
          <dd>
            TBD. I think we want more control than just "When it finishes, go
            backwards." We want to be able to trigger the reverse animation on
            demand. Maybe we can have direction here as per CSS Animations and
            then add a parameter on <code>WebAnimationTemplate</code> that
            runs the animation in reverse? In SVG/CSS you could specify
            different conditions that trigger the reverse effect?
          </dd>
          <dt>attribute float startTime</dt>
          <dd>
            The time at which the animation becomes active expressed in
            seconds relative to the parent animation group.
            <span class="todo">Need to define what happens when you change
              this for an animation in flight. Maybe it should be
              read-only?</span>
          </dd>
          <dt>readonly attribute float endTime</dt>
          <dd>
            The time at which the animation ceases to be active expressed in
            seconds relative to the parent time container.
          </dd>
          <dt>readonly attribute unrestricted float? simpleTime</dt>
          <dd>
            The time in seconds representing the offset into the simple
            duration using the steps described in <a
              href="#calculating-the-simple-time" class="sectionRef"></a>. As
            a result of that definition, this property will be
            non-<code>null</code> only when the animation is affecting its
            target.
          </dd>
          <dt>readonly attribute float? animationTime</dt>
          <dd>
            The time in seconds representing the offset into the animation
            phase. It is calculated using the steps described in <a
              href="#calculating-the-animation-time" class="sectionRef"></a>. As
            a result of that definition, this property will be
            non-<code>null</code> if and only if the animation is in the
            animating phase.
          </dd>
          <dt>attribute float startDelay</dt>
          <dd>
            The number of seconds from <code>startTime</code> until the timed
            item should begin executing.
            <span class="todo">Need to define what happens when you change
              this for an animation in flight. Make it read-only?</span>
          </dd>
          <dt>attribute WebTimingFunction timingFunction</dt>
          <dd class="todo">
            TBD.
          </dd>
          <dt>attribute unsigned short fill</dt>
          <dd>
            Fill mode as specified by one of the WEBA_FILL_* constants defined
            in this interface.
          </dd>
          <dt>readonly attribute WebAnimationGroup parentGroup</dt>
          <dd>
            The parent animation group
          </dd>
          <dt>void setPauseState (bool pauseState)</dt>
          <dd>
            Sets the pause state of this timed item.
            <span class="todo">Need to define how this works somewhere. e.g.
              for sequence containers, you just keep playing and then get
              stuck when you hit a paused one I guess. Also, need to define
              the interaction with <code>seek</code>.</span>
          </dd>
          <dt>bool getPauseState ()</dt>
          <dd>
            Retrusn the pause state of this timed item. Note that even if this
            returns false, the timed item might still be effectively paused by
            an ancestor animation group.
          </dd>
          <dt>bool isPaused ()</dt>
          <dd>
            Returns <code>true</code> if the pause state of this
            object <em>or one of its ancestor animation groups</em> is
            <code>true</code>.
          </dd>
          <dt>void seek (unsigned long activeTime)</dt>
          <dd>
            <span class="todo">TBD</span>
          </dd>
          <dt>void cancel ()</dt>
          <dd>
            Terminates the item and all its descendents such that they become
            inactive. Currently active items will have their
            <code>endTime</code> set to the current time of their parent
            group.
          </dd>
        </dl>
        <div class="todo">
          <p>
            Similar to <code>cancel</code>, do we want a method to terminate and
            then remove an item from its parent group? It seems like that's what
            you want to do for interactive stuff, UI stuff etc. That way you
            don't need to worry about removing those animations on a backwards
            seek?</span>
          </p>
          <p>
            Probably want methods for getting the startTime etc. in document
            time (i.e. in terms of the root time container). Or is it ok just to
            have a method on the parent time container you pass your time to and
            it does the conversion? Note that the conversion is not necessarily
            as trivial as it seems if the parent time container is paused.
          </p>
        </div>
      </section>
      <p>
        Need to add:
        <ul>
          <li>Adaptive duration</li>
          <li>Repeat by duration (i.e. iterationDuration)</li>
          <li>Pre-defined timing functions, spline-based timing functions etc.
          (want to allow a series of splines, not just four points)</li>
          <li>Custom easing functions</li>
          <li>Pace control (e.g. <code>pace="10px/s"</code>?)</li>
          <li>Reversing</li>
          <li>Speed control (only belongs on containers?)</li>
        </ul>
      </p>
    </section>

    <section>
      <h2>Grouping and synchronization</h2>
      <p>
        Describe basic properties: can be seeked etc.
      </p>
      <p>
        Describe different types: par, seq, mediagroup. Do we need a concept of
        "effective start time" for seq?
      </p>
      <p>
        Describe how repetition works.
      </p>
      <p>
        Need to define "animation group time". I think this is probably the same
        as the <code>startTime</code> member of the <a>WebTimedItem</a>
        interface. Since, if you add a delay to an animation group, its
        intuitive that zero-time for that group is when the delay finishes (or
        does the group behave as if it is paused for the delay? i.e. the
        animation group time is zero at the start of the delay and at the end?)
      </p>
      <p>
        Integration with <code>&lt;video&gt;</code> etc.
      </p>
      <p>
        Describe how the timeline itself is itself just a group but has the
        following special properties:
      </p>
      <ul>
        <li>It cannot be appended as a child of another group. As a result the
        <code>parentGroup</code> property returns <code>null</code>.</li>
        <li>A lot of other properties are read-only like
        <code>iterationCount</code> etc.</li>
        <li>It's startTime represents real-world time??? Can we align with the
        timestamps used in DOM (e.g. for events) here?</li>
      </ul>
      <section>
        <h3>The <code>WebAnimationGroup</code> interface</h3>
        <p>
          Represents a list of timed items which may be animations or
          nested animation groups. Order is significant only when
          <code>type</code> is <code>WEBA_SYNC_SEQ</code>.
        </p>
        <div class="feedbackWanted">
          <p>
            For adding and removing items this interface relies on passing in
            actual <a>WebTimedItem</a> objects. This is similar to the Element
            interface but differs from many SVG interfaces which use numeric
            indices instead.
          </p>
          <p>
            Using objects instead of indices is generally more useful since,
            even if you only know the index you can easily convert it to an
            object (e.g. <code>remove(group.getItem(2))</code>) but the reverse
            conversion is more difficult. However, there are performance costs
            associated with creating these objects in situations where indices
            are sufficient.
          </p>
          <p>
            With the interface defined below, it's really hard to (a) remove and
            re-add an item in the same place, (b) move an item forward one
            place. DOM doesn't have this problem because it has
            <code>nextSibling</code> and co. The SVG interfaces also don't have
            this problem because they use indexes but they <em>do</em> have
            the problem that working with a passed in object is very difficult
            (because you don't know its index). Maybe we need nextSibling? Or
            something to take an item and find its index?
          </p>
          <p>
            Also, the use of exceptions below is perhaps a little inconsistent.
            I've used exceptions for cases which are exceptional. For
            <code>item</code> I think it's reasonable to return null (like
            <code>NodeList</code>). Likewise, for <code>remove</code> I think
            it's useful to just return <code>null</code> rather than throwing
            an exception (e.g. if it has already been removed / not yet added).
            Maybe you really want to return null if it has no parent and throw
            an exception if it belongs to another group?
          </p>
        </div>
        <dl title="[Constructor] interface WebAnimationGroup : WebTimedItem"
          class="idl">
          <dt>const unsigned short WEBA_SYNC_PAR = 0</dt>
          <dd>
            Parallel synchronization.
          </dd>
          <dt>const unsigned short WEBA_SYNC_SEQ = 1</dt>
          <dd>
            Sequence synchronization.
          </dd>
          <dt>const unsigned short WEBA_SYNC_MEDIA = 2</dt>
          <dd>
            Media group synchronization.
          </dd>
          <dt>readonly attribute unsigned long length</dt>
          <dd>
            The number of timed items in the group.
          </dd>
          <dt>attribute unsigned short type</dt>
          <dd>
            <p>
              The type of synchronization provided by this animation group
              as specified by one of the <code>WEBA_SYNC_*</code> constants
              defined in this interface.
            </p>
            <p>
              Setting this value has the following effect:
            </p>
            <ol>
              <li>
                If <code>type</code> is set to the same value as the previous
                value return.
              </li>
              <li>
                Record the current container time.
              </li>
              <li>
                For each child in the group, call <code>cancel</code>.
              </li>
              <li>
                Seek the container time to zero.
              </li>
              <li>
                Calculate the effective start time of each child in the group
                using the new synchronization type <span class="todo">(Need
                a cross-reference to somewhere where we describe this
                behaviour and define things like "effective start time".)</span>
              </li>
              <li>
                Seek the container time to the previously recorded time.
              </li>
            </ol>
            <p class="feedbackWanted">
              Note that a consequence of the above is that, for example, if you
              change a container from type <code>par</code> to
              <code>mediaGroup</code> you could potentially generate a lot of
              end events followed by a lot of begin events despite the fact that
              the animation might not produce any different visual result. We
              could change the behaviour so that it effectively records the
              play state of each item before and then after the "seek"
              dispatches the appropriate events.
            </p>
          </dd>
          <dt>void clear ()</dt>
          <dd>
            Removes all child timed items from the group.
          </dd>
          <dt>WebTimedItem append (WebTimedItem newItem)</dt>
          <dd>
            Add <code>newItem</code> as the last item in the group. If
            <code>newItem</code> already belongs to a group (including this
            group) it will first be removed from that group before being added
            to this group. Returns <code>newItem</code>.
          </dd>
          <dt>WebTimedItem insertBefore (WebTimedItem newItem,
            WebTimedItem? refItem)</dt>
          <dd>
            <p>
              Inserts <code>newItem</code> before the existing
              <code>refItem</code>. If <code>refItem</code> is null,
              <code>newChild</code> is added to the end of the list. If
              <code>newItem</code> already belongs to a group (including this
              group) it will first be removed from that group before being added
              to this group. If <code>newItem</code> and <code>refItem</code>
              are the same object then no change is made. Returns
              <code>newItem</code>.
            </p>
            <p class="feedbackWanted">
              What events are fired? If <code>newChild</code> is removed from
              a group then fire end event?
            </p>
            <p>Exceptions:</p>
            <ul>
              <li>HIERARCHY_REQUEST_ERR: Raised if <code>newItem</code> is
              a root animation group for a document <span class="todo">(need
              cross-ref here)</span>.</li>
              <li>NOT_FOUND_ERR: Raised if <code>refItem</code> is not a child
              of this group.</li>
            </ul>
          </dd>
          <dt>WebTimedItem? item (unsigned long index)</dt>
          <dd>
            Returns the item at <code>index</code>. If <code>index</code> is
            greater than or equal to <code>length</code> returns
            <code>null</code>. Equivalent to
            <code>WebAnimationGroup[index]</code>. <span class="todo">(Need to
            work out how to define this behavior&mdash;i.e. that you can use the
            subscript operator)</span>
          </dd>
          <dt>WebTimedItem? remove (WebTimedItem removedItem)</dt>
          <dd>
            Removes <code>removedItem</code> from the group and returns it. If
            <code>removedItem</code> is not part of this group, returns
            <code>null</code>.
          </dd>
          <dt>sequence&lt;WebAnimation&gt; getActiveAnimations ()</dt>
          <dd>
            Returns all descendent WebAnimation objects that are active. The
            returned sequence is a snapshot (i.e. not live) representing the
            state of animations at the time returned by the
            <code>currentTime</code> property of this WebAnimationGroup object
            when this method was called.
          </dd>
          <dt>sequence&lt;WebAnimation&gt; getAnimationsForElement (Element
            elem)</dt>
          <dd>
            Returns all descendent WebAnimation objects whose
            <code>targetElement</code> is <code>elem</code>. As with
            <code>getActiveAnimations</code>, the returned sequence is
            a snapshot (i.e. not live) representing the state of the animation
            tree when this method was called. <span class="todo">(Need to define
            "animation tree" or find another word?)</span>
          </dd>
        </dl>
      </section>
    </section>

    <section>
      <h2>Animation values</h2>
      <section>
        <h3>Animation fill behavior</h3>
      </section>
      <section>
        <h3>The <code>WebAnimationFunction</code> interface</h3>
        <p>
          I think most of the members of the interface, perhaps all, should be
          readonly when this object is returned from a <code>WebAnimation</code>
          object. Objects returned from a <code>WebAnimationTemplate</code>,
          however, are live.
        </p>
        <p>
          <dl title="[Constructor] interface WebAnimationFunction" class="idl">
            <dt>attribute DOMString property</dt>
            <dd>
              The target attribute / property. <code>property</code> is probably
              a reserved word we should avoid though.
            </dd>
            <dt>attribute WebAnimationFrameList frames</dt>
            <dd>
              The series of values that make up this function sorted by their
              offset within the simple duration of the animation.
            </dd>
            <dt>attribute unsigned short additive</dt>
            <dd>
              This depends how addition works
            </dd>
            <dt>attribute unsigned short accumulate</dt>
            <dd>
              This also depends how addition works
            </dd>
            <dt>attribute DOMString? pace</dt>
            <dd>
              This is just a placeholder for some kind of <i>whole-animation
              -function</i> timing control. For example, SVG has
              <code>calcMode="paced"</code> which looks at all the frames in the
              animation and adjusts the timing so the pace of change is
              constant (this is especially useful for motion on a path).<br>
              The example here could take values <code>null</code> (default),
              "auto", or something like "1px/s" (not sure what the datatype
              should be here). Not sure yet how this will work with adaptive
              duration if other animation functions use also this.
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFunctionCollection</code> interface</h3>
        <p>
          Yeah, the name is a mouthful, but like <code>HTMLCollection</code> you
          rarely use this directly. I'm not sure if &lsquo;collection&rsquo; is
          the right terminology. It's basically an unordered list.
          <dl title="interface WebAnimationFunctionCollection" class="idl">
            <dt>readonly attribute unsigned long length</dt>
            <dd>
              The number of functions in the collection.
            </dd>
            <dt>WebAnimationFunction? item(unsigned long index)</dt>
            <dd>
              Gets the function at <code>index</code> if it exists. We only
              have this so you can enumerate the list. But the danger is then
              apps start to assume the list is in a certain order. So wherever
              we use this we really should define that order.
            </dd>
            <dt>WebAnimationFunction? namedItem(DOMString propertyName)</dt>
            <dd>
              Returns the <code>WebAnimationFunction</code> with
              <code>property</code> = <code>propertyName</code> or null
              otherwise. 
            </dd>
            <dt>WebAnimationFunction add(WebAnimationFunction function)</dt>
            <dd>
              Adds <code>function</code> to the collection. If there is already
              a function in the collection targetting the same property (do we
              compare properties in a case-insensitive manner? After stripping
              whitespace?) it will be removed before this is added. If
              <code>function</code> already exists in this collection no change
              will be made?? Does that break assumptions about order though? We
              could just say it will be moved to the end of the list
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFrame</code> interface</h3>
        <p>
          <dl title="[Constructor] interface WebAnimationFrame" class="idl">
            <dt>attribute any value</dt>
            <dd>
              The attribute / property value for the given frame
            </dd>
            <dt>attribute float offset</dt>
            <dd>
              A value between 0 and 1 (inclusive) representing the offset within
              the simple duration of the animation where this value should
              appear. Ignored if we're using paced timing?<br>
              What happens if you change it? The array returned by the
              <code>WebAnimationFunction</code> is updated? I guess that's fine
              if it's just an array. Any already-returned arrays wouldn't need
              to be updated.<br>
              What happens if you have two values with the same offset? It would
              be nice if the result was deterministic rather than just left up
              in the air (since the more you leave undefined, the more you let
              the Web define it for you).
            </dd>
            <dt>attribute WebTimingFunction timingFunction</dt>
            <dd>
              The function to use for this segment. Would a string do here? E.g.
              "ease" or "cubic-bezier(1 0 0.3 1)"? Probably not. It's a little
              too CSS-specific for a start, and we want to allow this to
              potentially be a function pointer.<br>
              Ignored if we're using paced timing
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFrameList</code> interface</h3>
        <p>
          <dl title="interface WebAnimationFrameList" class="idl">
            <dt>readonly attribute unsigned long length</dt>
            <dd>
              The number of frames in the list.
            </dd>
            <dt>WebAnimationFrameList? item(unsigned long index)</dt>
            <dd>
              Returns the frame at <code>index</code> if it exists or null.
            </dd>
            <dt>WebAnimationFrameList? add(WebAnimationFrame frame)</dt>
            <dd>
              Adds <code>frame</code> to the list such that the list is sorted
              by the offset of the frames. If there's already a frame with the
              same offset? This one comes after?
            </dd>
            <dt>WebAnimationFrameList? remove(unsigned long index)</dt>
            <dd>
              Adds <code>frame</code> to the list such that the list is sorted
              by the offset of the frames. If there's already a frame with the
              same offset? This one comes after?
            </dd>
          </dl>
        </p>
        <p>
          Not sure about the <code>remove</code> method. Do we want:
          <ul>
            <li><code>remove(WebAnimationFrame frame)</code>?</li>
            <li><code>removeAtOffset(unsigned long offset)</code>?</li>
            <li><code>itemAtOffset(unsigned long offset)</code>?</li>
          </ul>
        </p>
      </section>
      <p>
        Need to add:
        <ul>
          <li>Pre-defined timing functions, spline-based timing functions etc.
          (want to allow a series of splines, not just four points)</li>
          <li>Custom easing functions</li>
          <li>Pace control (e.g. <code>pace="10px/s"</code>?)</li>
          <li>Motion on a path</li>
          <li>General functional syntax</li>
          <li>&lsquo;to&rsquo; animation</li>
        </ul>
      </p>
      <p>
        Somewhere we need to describe how animated values get stored in the DOM.
        i.e. can you access them at all? what's the interaction with various
        override stylesheets etc.
      </p>
      <p>
        Need to add a way for getting animation values of motion-on-a-path
        animations
      </p>
    </section>

    <section>
      <h2>Combining animations</h2>
      <p>
        Animation addition
      </p>
    </section>

    <section>
      <h2>Animation state</h2>
      <p>
        State machines
      </p>
    </section>

    <section>
      <h2>Animation events</h2>
      <p>
        Need to consider how to align with existing
        <code>TransitionEvent</code>s, <code>AnimationEvent</code>s and
        <code>TimeEvent</code>s. It might make sense to have our events inherit
        from one or more of these interfaces or have implementations dispatch
        both (especially if their synchronization properties differ).
      </p>
      <p>
        I think we might also want a seek event? It seems like a lot of
        applications will want to do bookkeeping when there's
        a seek&mdash;especially a backwards seek. It might also be necessary for
        the SVG bindings so you can clear certain events on a backwards seek as
        required by SMIL.
      </p>
      <section>
        <h3>Synchronizing event handlers</h3>
        <p>
          Your text...
        </p>
      </section>
    </section>

    <section>
      <h2>Extensions to Document interfaces</h2>
      <p>
        Since the document acts as a root animation group user agents MUST add
        an <code>animationRoot</code> member to the document interface for each
        document type where animation is supported. For example, HTMLDocument
        and SVGDocument.
      </p>
      <p>
        The definition of this member is given below.
      </p>
      <dl title="partial interface HTMLDocument" class="idl">
        <dt>readonly attribute WebAnimationGroup animationRoot</dt>
        <dd>
          The animation group corresponding to the root of the document. This
          group exhibits the special behaviour described for a root animation
          group in
          <a href="#grouping-and-synchronization" class="sectionRef"></a>.
        </dd>
      </dl>
    </section>

    <section>
      <h2>Animation of common data types</h2>
      <p>
        Need to describe how to interpolate/add both:
        <ol>
          <li>Integers, floats, strings etc.</li>
          <li>CSS and SVG types (colors etc.)</li>
          <ul><li>Support for HSL (if the colors are specified in HSL we should
            interpolate in that notation; but it should also be possible to
            do so regardless of how the colors are specified)</li></ul>
        </ol>
      </p>
      <p>
        For transforms I think it's defined elsewhere so we can either just
        point to that spec, or just refer to the fact that other specs should
        define how their types should be supported (or not) for animation.
      </p>
      <p>
        Need to provide facility for smooth interpolation of arbitrary paths.
      </p>
    </section>

    <section>
      <h2>Animation style</h2>
      <section>
        <h3>The <code>transition-*</code> properties</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>animation-*</code> properties</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>CSSAnimationTemplate</code> interface</h3>
        <p>
          <dl title="interface CSSAnimationTemplate : WebAnimationTemplate"
            class="idl">
          </dl>
        </p>
      </section>
      <section>
        <h3>Querying the animated style</h3>
        <p>
          Need to describe <code>window.getAnimatedStyle(DOMString
            selector)</code> here.
        </p>
      </section>
    </section>

    <section>
      <h2>Animation elements</h2>
      <section>
        <h3>The <code>&lsquo;animate&rsquo;</code> element</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>&lsquo;set&rsquo;</code> element</h3>
        <p>
          Your text...
        </p>
        <p>
          The <code>&lsquo;animateColor&rsquo;</code> and
          <code>&lsquo;animateTransform&rsquo;</code> elements are deprecated.
          Can we get rid of <code>&lsquo;animateMotion&rsquo;</code> too?
        </p>
      </section>
      <section>
        <h3>The <code>SVGAnimationElement</code> interface</h3>
        <p>
          <dl title="interface SVGAnimationElement : WebAnimationTemplate"
            class="idl">
          </dl>
        </p>
        <p>
          Need to describe how to set up named animations using these elements.
        </p>
      </section>
    </section>

    <section>
      <h2>Making animation accessible</h2>
      <p>
        Describe how to integrate with the <a
          href="http://www.whatwg.org/specs/web-apps/current-work/#timed-text-tracks">Timed
          Text API</a> and give examples of how to author content so it is
        accessible.
      </p>
    </section>

    <section>
      <h2>Definitions</h2>
      <dl>
        <dt>active interval</dt>
        <dd>
          <p>
            The interval during which a timed item may affect its animation
            targets.
          </p>
          <p>
            The start of this interval is the start time specified on
            the timed item. For an animation with no start delay, this will be
            coincident with the start of animation.
          </p>
          <p>
            The end of this interval is the first moment after the start time
            when the timed item and all of its children have ceased animating
            and applying fill effects. For timed items with infinite duration or
            forwards fill effects, the end time is infinite.
          </p>
        </dd>
        <dt>animation time</dt>
        <dd>
        </dd>
        <dt>simple time</dt>
        <dd>
        </dd>
      </dl>
      <p>
        Need to define active time, simple time etc. here
      </p>
    </section>

    <section class='appendix'>
      <h2>Acknowledgements</h2>
    </section>
  </body>
</html>

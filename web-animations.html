<!DOCTYPE html>
<html>
  <head>
    <title>Web Animations 1.0</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js'
      class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use
          // ED.
          specStatus: "unofficial",

          // the specification's short name, as in
          // http://www.w3.org/TR/short-name/
          // shortName:            "web-anim",

          // if your specification has a subtitle that goes below the main
          // formal title, define it here
          // subtitle   :  "an excellent document",

          // if you wish the publication date to be other than today, set this
          // publishDate:  "2009-08-06",

          // if the specification's copyright date is a range of years, specify
          // the start date here:
          // copyrightStart: "2005"

          // if there is a previously published draft, uncomment this and set
          // its YYYY-MM-DD date and its maturity status
          // previousPublishDate: "1977-03-15",
          // previousMaturity: "WD",

          // if there a publicly available Editor's Draft, this is the link
          // edDraftURI:
          // "http://dev.w3.org/2009/dap/ReSpec.js/documentation.html",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",

          // if you want to have extra CSS, append them to this list
          // it is recommended that the respec.css stylesheet be kept
          extraCSS: ["http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css",
                     "web-animations.css"],

          // Turning off inlineCSS for now since if extraCSS points to
          // a relative URL your testing from a file URL the XHR will fail.
          // Probably should turn this back on once this is hosted on a server
          // somewhere.
          inlineCSS: false,

          // editors, add as many as you like
          // only "name" is required
          // XXX I've only put this in because the template requires it. I'm not
          // sure how important the order is but for now I've done it in
          // alphabetical order
          editors:  [
              { name: "Brian Birtles", mailto: "bbirtles@mozilla.com",
                company: "Mozilla Japan", companyURL: "http://mozilla.jp/" },
              { name: "Rik Cabanier", mailto: "cabanier@adobe.com",
                company: "Adobe Systems", companyURL: "http://www.adobe.com/" },
              { name: "Alex Danilo", mailto: "adanilo@google.com",
                company: "Google, Inc", companyURL: "http://www.google.com/" },
              { name: "Shane Stephens", mailto: "shans@google.com",
                company: "Google, Inc", companyURL: "http://www.google.com/" },
          ],

          // authors, add as many as you like.
          // This is optional, uncomment if you have authors as well as editors.
          // only "name" is required. Same format as editors.

          //authors:  [
          //    { name: "Your Name", url: "http://example.org/",
          //      company: "Your Company", companyURL: "http://example.com/" },
          //],

          // XXX If we continue using ReSpec then we need to tweak it to support
          // multiple working groups. It includes updating the patent section
          // prose to say "groups" instead of "group" etc.
          // name of the WG
          // wg: "CSS Working Group (part of the Style Activity) and the SVG " +
          //     "Working Group (part of the Graphics Activity)",

          // URI of the public WG page
          // wgURI: "http://www.w3.org/Graphics/fx/",

          // name (without the @w3c.org) of the public mailing to which comments
          // are due
          wgPublicList: "public-fx",

          // URI of the patent status for this WG, for Rec-track documents
          // !!!! IMPORTANT !!!!
          // This is important for Rec-track documents, do not copy a patent URI
          // from a random document unless you know what you're doing. If in
          // doubt ask your friendly neighbourhood Team Contact.
          wgPatentURI:  "",

          noIDLSorting: true,
          noIDLIn: true
      };
    </script>
    <!--
      ReSpec.js wishlist:

      Add here any issues you find with ReSpec including missing features. It
      will help us decide if we should continue using it and work out what we
      need to fix.

      * Need ability to cross-reference members of interfaces (e.g. constants
        etc.)
    -->
  </head>
  <body>
    <section id='abstract'>
      This is the abstract for your specification.
    </section>

    <section>
      <h2>Introduction</h2>
      <p>
        Your text...
      </p>
      <section>
        <h3>Relationship to other specifications</h3>
        <p>
          CSS Transitions, CSS Animations, SVG, SMIL
        </p>
      </section>
    </section>

    <section class="informative">
      <h2>The animation timeline</h2>
      <p>
        Each document contains a timeline to which animations may be added. Each
        animation has a start time which determines when the animation becomes
        active. After the animation has completed, the animation becomes
        inactive.
      </p>
      <div class="figure">
        <object data="img/timeline.svg" width="600"></object>
      </div>
      <p class="caption">
        At time <em>t</em> animations A and B are active. Animation C has
        already completed and is now inactive. Animation D has yet to begin and
        is also inactive.
      </p>
      <section>
        <h3>Start of the timeline</h3>
        <p class="todo">
          Define when the timeline starts&mdash;is it document load, or can it
          start beforehand?
        </p>
      </section>
    </section>

    <section>
      <h2>Animations in the timeline</h2>
      <p>
        Animations in the timeline are represented by
        <code>WebAnimationInstance</code> objects.
      </p>
      <section>
        <h3>The <code>WebAnimationInstance</code> interface</h3>
        <dl title="interface WebAnimationInstance : WebTimedItem" class="idl">
          <dt>attribute WebAnimationFunctionCollection functions</dt>
          <dd>
            <p>
              A read-only set of animation functions to animate, one per target
              property / attribute. As with <code>HTMLCollection</code>, in
              ECMAScript you should be able to just use
              <code>functions["height"]</code> to get the appropriate function
              (rather than <code>functions.namedItem("height")</code>).
            </p>
            <div class="feedbackWanted">
              <p>
                I'm not sure how to do this. A few options:
              </p>
              <ol>
                <li>
                  Make this a read-only copy of
                  <code>animation.functions</code>. i.e. the object identities
                  are different but this object still tracks changes to that
                  one. This means if you want to update to the "master" object
                  you have to go to the template to do it. Then maybe you have
                  a <code>setFunctions</code> object here to take any function
                  collection and make a read-only copy here (that way you can
                  plug in your own one and still revert to the original).
                </li>
                <li>
                  Have a separate <code>localFunctions</code> property. Then
                  have <code>functions</code> be the union of
                  <code>localFunctions</code> and
                  <code>animation.functions</code>. When two functions are
                  indexed on the same property, <code>localFunctions</code>
                  wins. This approach doesn't let you drop the function property
                  for a property though unless you add some kind of
                  null-function in.
                </li>
                <li>
                  Have a <code>overrideFunctions</code> property that, if set,
                  simply overrides <code>animation.functions</code> wholesale.
                </li>
                <li>
                  Just make <code>functions</code> refer to
                  <code>animation.functions</code>. i.e. changes made to
                  <code>functions</code> here affect all animation instances
                  from the same template. I don't like this at all, especially
                  since it's inconsistent with what we do for timing properties.
                </li>
              </ol>
            </div>
          </dd>
          <dt>readonly attribute WebAnimation animation</dt>
          <dd>
            The <code>WebAnimation</code> object from which this object was
            minted (see <a href="#creating-animations" class="sectionRef"></a>).
          </dd>
          <dt>readonly attribute Element targetElement</dt>
          <dd>
            The element being animated by this object.
          </dd>
        </dl>
      </section>
    </section>

    <section>
      <h2>Creating animations</h2>
      <p>
        <code>WebAnimationInstance</code> objects are not created directly, but
        via a separate <code>WebAnimation</code> object. The
        <code>WebAnimation</code> object acts a template allowing the same set
        of animation parameters to be used multiple times with multiple target
        elements.
      </p>
      <p>
        Changes made to the <code>WebAnimation</code> object are reflected in
        <code>WebAnimationInstance</code> objects previously generated from the
        <code>WebAnimation</code> unless the properties that were changed have
        been explicitly overriden on the <code>WebAnimation</code> object.
      </p>
      <section>
        <h3>The <code>WebAnimation</code> interface</h3>
        <p>
          <dl title="[Constructor] interface WebAnimation" class="idl">
            <dt>attribute WebTiming timing</dt>
            <dd>
              The timing parameters to use for generated animations.
            </dd>
            <dt>attribute WebAnimationFunctionCollection functions</dt>
            <dd>
              A series of animation functions, one per target property
              / attribute. As with <code>HTMLCollection</code>, in ECMAScript
              you should be able to just use <code>functions["height"]</code> to
              get the appropriate function (rather than
              <code>functions.namedItem("height")</code>).
            </dd>
            <dt>sequence&lt;WebAnimationInstance&gt; animate (any target,
              optional float startTime)</dt>
            <dd>
              <p>
                Creates a series of <code>WebAnimationInstance</code> objects,
                one for each element in <code>target</code>. For each
                <code>element</code> in <code>target</code> the associated
                animation is appended to the animation group corresponding to
                <code>element.ownerDocument.animationRoot</code>.
              </p>
              <p>
                <code>target</code> may be one of the following types:
                <code>Element</code>, <code>NodeList</code>,
                <code>Element[]</code>. If <code>target</code> is of type
                <code>NodeList</code> all nodes in the list that are not of type
                <code>ELEMENT_NODE</code> are ignored.
              </p>
              <p>
                <code>startTime</code> represents a time in the context of the
                <code>WebAnimationGroup</code> to which it is appended. If this
                parameter is not specified it will default to the current time
                of the animation group to which it is appended.
              </p>
              <p>
                The <code>WebAnimationInstance</code> objects created by this
                method behave independently of this object as described in <a
                href="#creating-animations" class="sectionRef"></a>.
              </p>
            </dd>
            <dt>sequence&lt;WebAnimationInstance&gt; animateWithParent
              (any target, WebAnimationGroup? parentTimeline,
              optional float startTime)</dt>
            <dd>
              <p>
                Similar to <code>animate</code>, this method creates one
                <code>WebAnimationInstance</code> object for each element in
                <code>target</code> but then appends the resulting
                <code>WebAnimationInstance</code> objects as children of the
                given <code>parentTimeline</code>, if provided. If
                <code>parentTimeline</code> is <code>null</code>, the
                <code>WebAnimationInstance</code> objects will not be added to
                any group.
              </p>
              <p>
                The handling of <code>target</code> is the same as for
                <code>animate</code>.
              </p>
              <p>
                <code>startTime</code> represents a time in the context of the
                <code>WebTimelineInstance</code> to which it will be appended.
                In this case that <code>parentTimeline</code> is not null, this
                will be <code>parentTimeline</code>.
                If this parameter is not specified it will default to the
                current time of <code>parentTimeline</code> if it is not null,
                otherwise it will default to 0.
              </p>
            </dd>
          </dl>
          <div class="feedbackWanted">
            <p>
              The requirements for the <code>animate</code> are as follows.
              Regarding the animation target(s) we want to support:
            </p>
            <pre>
              animation.animate(document.getElementById("a"));
              animation.animate(document.querySelectorAll("div.warning"));</pre>
            <p>
              That is we want to support at least:
            </p>
            <ul>
              <li>Element</li>
              <li>NodeList (for <code>querySelectorAll</code>,
              <code>getElementsByTagName</code>, <code>Node.childNodes</code>
              etc.)</li>
            </ul>
            <p>
              It would be nice to also support an array of Elements.
            </p>
            <p>
              Regarding start time, it is necessary to be able to specify it.
              However, it is probably very useful to have a default behaviour
              that uses the current time of the container. That is, ideally this
              parameter should be optional.
            </p>
            <p>
              Regarding the parent animation group, there are three possible
              scenarios we probably want to support:
            </p>
            <ul>
              <li>Specify an explicit parent group</li>
              <li>Use the default animation group (<code>animationRoot</code>)
              of the element's <code>ownerDocument</code></li>
              <li>Have no parent group (This is particularly important
              animations destined for sequential animation groups containers
              where the order of children is important and so you might want to
              insert the animation yourself at a particular position. It's also
              likely there will be situations where you want to make the
              animation and attach it later such as a helper function that
              returns an animation instance object for the caller to
              insert.)</li>
            </ul>
            <p>
              That gives you up to 18 permutations of ways of calling
              <code>animate</code>. At the same time, we want
              <code>animate</code> to be as simple to use as possible. The above
              interface is an attempt to balance these requirements. It depends
              on WebIDL and ECMAScript either being able to do overloading by
              parameter type or accepting an "any" type and then checking the
              type of the argument. I'm not sure what the best way is to do
              this.
            </p>
          </div>
        </p>
      </section>
    </section>

    <section>
      <h2>Timing animations</h2>
      <p>
        Explanation about timing stuff, active time, simple time etc.
      </p>
      <section class="informative">
        <h3>Animation phases</h3>
        <p>
          An individual animation instance can be in one of three possible
          states, called phases:
        </p>
        <dl>
          <dt>Inactive</dt>
          <dd>The animation instance has yet to start or has already finished.
          Whether it effects its target depends on its fill mode.</dd>
          <dt>Delayed (active)</dt>
          <dd>The animation instance is waiting to start (assuming time is
          progressing forwards). Depending on the animation instance's fill
          mode, it may apply a backwards fill to its target at this time.</dd>
          <dt>Animating (active)</dt>
          <dd>The animation instance is executing, and will apply its effect to
          its target.</dd>
        </dl>
        <p>
          An animation instance is considered <em>active</em> if it is in the
          <em>delayed</em> or <em>animating</em> phases.
        </p>
        <p>
          These phases can be visualized as follows:
        </p>
        <div class="figure">
          <object data="img/animation-phases.svg" width="600"></object>
        </div>
        <p class="caption">
          Animation phases.
        </p>
        <p>
          Depending on the an animation instance's properties, it may not enter
          all of these phases.
        </p>
      </section>
      <section class="informative">
        <h3>Simple time and animation time</h3>
        <p>
          Times in Web Animations are relative to some point of reference. These
          different points of reference produce different time spaces. An
          analogue is computer graphics where a graphical element may be present
          in one of a number of different coordinate spaces. <span
          class="todo">(This analogue doesn't quite work. Is it better to drop
          it? Does it make sense to others?)</span>
        </p>
        <p>
          Within Web Animations, the following time spaces are used:
        </p>
        <dl>
          <dt>Document time</dt>
          <dd>
            A time space whose zero point is the start time of the document
            timeline as defined in <a href="#start-of-the-timeline"
              class="sectionRef"></a>.
          </dd>
          <dt>Parent simple time</dt>
          <dd>
            A time space whose zero time is the beginning of the parent
            animation group's current iteration.
            Unless the document creates additional animation groups, this will
            be equivalent to document time.
          </dd>
          <dt>Item time</dt>
          <dd>
            A time space whose zero time is when the item becomes active. If the
            item is not yet active but has a defined start time, this time may
            be negative.
          </dd>
          <dt>Animation time</dt>
          <dd>
            A time space whose zero time is when the item begins animating. It
            is undefined when the item is not animating and hence cannot be
            negative.
          </dd>
          <dt>Simple time</dt>
          <dd>
            A time space whose zero time is the beginning of the current
            iteration. It is defined whenever the parent simple time is defined.
          </dd>
        </dl>
        <p>
          Some of these time spaces are demonstrated below.
        </p>
        <div class="figure">
          <object data="img/time-spaces.svg" width="600"></object>
        </div>
        <p class="caption">
          A comparison of item time, animation time, and simple time for an
          animation with a simple duration of 1s and an iteration count of 2.5.
        </p>
        <section>
          <h4>Simple duration and animation duration</h4>
          <p>
            These time spaces can also be used to describe intervals and
            durations. The distinction between simple duration and active
            duration is particularly common. The definition of these terms falls
            out of the definition of the time spaces and is summarized as
            follows:
          </p>
          <dl>
            <dt>Simple duration</dt>
            <dd>
              The time taken for a single iteration of the item to complete.
            </dd>
            <dt>Animation duration</dt>
            <dd>
              The time taken for the animation phase of the item to complete.
              This may be longer or shorter than the simple duration.
            </dd>
          </dl>
          <p>
            This may be visualized as follows:
          </p>
          <div class="figure">
            <object data="img/simple-and-animation-duration.svg"
                width="600"></object>
          </div>
          <p class="caption">
            A comparison of the simple and animation durations for an animation
            with an iteration count of 2.5.<br>
            Note that the simple duration for the final iteration does not
            change, it is simply cut-off by the animation duration.
          </p>
        </section>
        <section>
          <h4>Interval timing</h4>
          <p>
            For intervals of time, Web Animations uses an endpoint-exclusive
            timing model. This means that whilst the begin time of an interval
            is included in the interval, the end time time is not. In interval
            notation this can written <code>[begin,end)</code>. This model
            provides sensible behavior when intervals are repeated and sequenced
            since there is no overlap between intervals.
          </p>
          <p>
            In the examples below, for the repeated animation, at animation time
            1s, the simple time is 0. For the sequenced animation, at parent
            simple time 1s, animation A has finished animating and animation
            B has begun; there is no overlap, only animation B is affecting the
            target.
          </p>
          <div class="figure">
            <object data="img/endpoint-exclusive-timing.svg"
                width="600"></object>
          </div>
          <p class="caption">
            Illustration of end-point exclusive timing. For both repeated and
            sequenced animations there is no overlap at the boundaries between
            intervals.
          </p>
          <p>
            An exception to this behaviour is that when performing a fill, if
            the fill begins at an interval endpoint, the endpoint is used. This
            behavior falls out of the algorithm given in <a
            href="#calculating-the-unscaled-simple-time"
            class="sectionRef"></a> and is demonstrated below.
          </p>
          <div class="figure">
            <object data="img/endpoint-exclusive-timing-and-fill.svg"
                width="600"></object>
          </div>
          <p class="caption">
            Caption: After one iteration, the first frame of the animation is
            shown, but after two iterations (and thereonwards), the last frame
            is shown due to the special behavior defined when an animation
            fills.
          </p>
        </section>
      </section>
      <section>
        <h3>Calculating the simple duration</h3>
        <p>
          The <var>simple duration</var> is calculated according to the
          following steps:
        </p>
        <p>
          The method for calculating an item's simple duration depends on the
          kind of item in question. Following are the steps for calculating the
          simple duration of an animation instance. The steps for calculating
          the simple duration of a timeinline instance are described in <a
        </p>
        <dl class="switch">
          <dt>
            If the <var>duration</var> timing property is set to a numerical
            value greater than or equal to zero (including positive infinity),
          </dt>
          <dd>
            return <var>duration</var>.
          </dd>
          <dt>
            If the <var>duration</var> timing property has the special value of
            "untilParentEnd",
          </dt>
          <dd>
            return <var>the simple duration of the parent timeline</var>
            - <var>the item's start time</var> - <var>the item's start
            delay</var>.
          </dd>
          <dt>
            If the <var>duration</var> timing property is set (but not one of
            the above values),
          </dt>
          <dd>
            return <code>Infinity</code>.
          </dd>
          <dt>
            Otherwise,
          </dt>
          <dd>
            return the item's <var>intrinsic duration</var>.
          </dd>
        </dl>
        <p>
          The value of an item's <var>intrinsic duration</var> depends on
          the type of the item. For animation instances the <var>intrinsic
          duration</var> is <code>Infinity</code>.
        </p>
        <div class="todo">
          <p>
            If we support <code>pace="10px/s"</code> then, when specified, it
            will allow animation instances to have an intrinsic duration.
          </p>
          <p>
            In specifying that, we need to define what happens when the simple
            duration and intrinsic duration don't match. Basically, if the
            simple duration is shorter, you chop off the remaining time. If the
            simple duration is longer, you do your fill behavior for that time.
            It probably makes most sense to specify that behavior where we
            define the mapping from simple time to the paced time. (Basically,
            if the paced time ends up being greater than the specified duration
            then you clamp to the specified duration and invoke fill behavior.)
          </p>
        </div>
        <p>
          The intrinsic duration for timeline instances and media items is
          described under <a
          href="#calculating-the-intrinsic-duration-of-a-timeline-instance"
          class="sectionRef"></a> and <a
          href="#the-intrinsic-duration-of-a-media-item"
          class="sectionRef"></a> respectively.
        </p>
      </section>
      <section>
        <h3>Calculating the animation duration</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Multiplying the simple duration by the iteration count</li>
          <li>Apply min and max (if they are supported)</li>
          <li>Applying any speed functions</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the item time</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Get the <var>simple time</var> from the parent group</li>
          <li>Subtract the <var>start time</var></li>
          <li>Subtract start offset&mdash;if we're currently paused, you update
          the start offset first (and update the pause start time with the
          parent simple time)</li>
          <li>Return the resulting time</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the animation time</h3>
        <p>
          This basically involves:
        </p>
        <ul>
          <li>Get the <var>item time</var> as described above</li>
          <li>Subtract the <var>start delay</var></li>
          <li>If it's negative, we're not animating, return
              <code>null</code>.</li>
          <li>If the time is greater than the animation duration, we're not
              animating, return <code>null</code>.</li>
          <li>Return the resulting time</li>
        </ul>
      </section>
      <section>
        <h3>Calculating the simple time</h3>
        <p class="note">
          We don't need to be concerned about pause times here, they will be
          taken care of when we calculate the item time (see <a
            href="#calculating-the-item-time" class="sectionRef"></a>).
        </p>
        <p>
          The simple time is calculated by first dividing the <var>animation
          time</var> into intervals. This is called the <var>unscaled simple
          time</var>. Following this, timing manipulations specified on the
          timed item are applied to the <var>unscaled simple time</var> to
          produce the <var>simple time</var>.
        </p>
        <section>
          <h4>Calculating the unscaled simple time</h4>
          <p>
            The <var>unscaled simple time</var> is calculated according to the
            following steps:
          </p>
          <ol>
            <li>
              If the <var>item time</var> is null (i.e. the animation's start
              time is not defined), return <code>null</code>.
            </li>
            <li>
              If <var>item time</var> &lt; <var>start delay</var> (i.e. the
              animation is delayed), return zero.
            </li>
            <li>
              If the simple duration is infinite, return zero.
            </li>
            <li>
              If the simple duration is zero, return the <var>simple
              duration</var>.
            </li>
            <li>
              If <var>animation time</var> is not <code>null</code> (i.e. the
              animation is animating), return <code><var>animation time</var>
              % <var>simple duration</var></code>.
            </li>
            <li>
              If the <var>animation duration</var> is a positive multiple of the
              <var>simple duration</var>, return the <var>simple duration</var>.
            </li>
            <li>
              Otherwise, return <code><var>animation duration</var>
              % <var>simple duration</var></code>.
            </li>
          </ol>
        </section>
        <section>
          <h4>Applying time manipulations</h4>
          <p>
            The <var>unscaled simple time</var> is converted into the
            <var>simple time</var> using the following steps:
          <ol>
            <li>
              If the <var>unscaled simple time</var> is <code>null</code>,
              return <code>null</code>.
            </li>
            <li>
              Let <var>scaled simple time</var> be the result of applying any
              timing function defined for this timed element to the
              <var>unscaled simple time</var>. <span class="todo">(Need more
              detail here, or a link to where this is defined.)</span>
            </li>
            <li>
              Calculate the <var>current direction</var> using the first
              matching condition from the following list:
              <dl class="switch">
                <dt>
                  If the direction is normal,
                </dt>
                <dd>Let the <var>current direction</var> be forwards.</dd>
                <dt>
                  If the direction is reverse,
                </dt>
                <dd>Let the <var>current direction</var> be reverse.</dd>
                <dt>
                  Otherwise,
                </dt>
                <dd>
                  <ol>
                    <li>
                      Let <var>d</var> be the <var>current iteration</var> (see
                      <a href="#calculating-the-current-iteration"
                        class="sectionRef"></a>).
                    </li>
                    <li>
                      If the direction is alternate-reverse increment
                      <var>d</var> by 1.
                    </li>
                    <li>
                      If the animation is not animating, and the
                      <var>animation duration</var> is a positive multiple of
                      the <var>simple duration</var> increment <var>d</var> by
                      1.
                    </li>
                    <li>
                      If <code><var>d</var> % 2 != 0</code>, let the
                      <var>current direction</var> be forwards, otherwise let
                      the <var>current direction</var> be reverse.
                    </li>
                  </ol>
                </dd>
              </dl>
            </li>
            <li>
              If the <var>current direction</var> is forwards then return
              the <var>scaled simple time</var>.
              <p>
                Otherwise, return the <var>simple duration</var> - <var>scaled 
                simple time</var>.
              </p>
            </li>
          </ol>
          <p class="note">
            Applying the reverse behaviour after the timing function means that
            ease-in becomes ease-out on reverse, however it avoids jumps in
            values when reversing part-way.
          </p>
        </section>
        <section>
          <h4>Calculating the current iteration</h4>
          <p>
            The <var>current iteration</var> can be calculated from the
            following steps:
          </p>
          <ol>
            <li>
              If the <var>item time</var> is <code>null</code>, return
              <code>null</code>.
            </li>
            <li>
              If the <code><var>item time</var> &lt; <var>start
              delay</var></code>, return zero.
            </li>
            <li>
              If the <var>simple duration</var> is zero, return
              <code>floor(<var>iteration count</var>)</code>.
            </li>
            <li>
              If <var>animation time</var> is not <code>null</code>, let
              <var>t</var> be the <var>animation time</var>, otherwise, let
              <var>t</var> be the <var>animation duration</var>.
            </li>
            <li>
              Return <code>floor(<var>t</var> / <var>simple
              duration</var>)</code>.
              <p class="note">
                If the <var>simple duration</var> is infinite, the
                result of <code>floor(<var>t</var> / <var>simple
                duration</var>)</code> will be zero as defined by IEEE 754.
              </p>
            </li>
          </ol>
        </section>
      </section>
      <section>
        <h3>Seeking a timed item</h3>
        <p>
          It might make sense to describe the behaviour for an animation first,
          and then for an animation group.
        </p>
        <p>
          Talk about how animation instances are not removed on a backwards seek
          so you need to remove them yourself or detect them and not re-create
          them.  Perhaps we will have a seek event for this? Or a way of marking
          animations as remove-on-seek (which would remove the animation if you
          do a backwards seek past its startTime).
        </p>
        <p>
          Talk about the 5-minute rule plus issues relating to not chewing up
          more-and-more memory.
        </p>
        <p>
          Once an animation instance has become inactive, ideally all you need
          to store is:
        </p>
        <ul>
          <li>start time</li>
          <li>pause intervals</li>
          <li>end time (it might have been cancelled so you can just calculate
              this)</li>
          <li>target element</li>
          <li>parent animation group</li>
          <li>pointer to animation (unless data has changed on the animation
          since this was made in which case you need to store the
          modifications)</li>
        </ul>
        <p>
          However, we have this idea that animations copy their shared data from
          their template when they are created (or is it when they become
          active?) So, if the template was changed, we should preserve the
          changed information too.
        </p>
        <p>
          Need to talk about what happens with regards to events too.
        </p>
      </section>
      <section>
        <h3>Specifying timing properties</h3>
        <p>
          Timing properties are collected under the <code>WebTiming</code>
          interface.
          For properties that are not explicitly set on a <code>WebTiming</code>
          object, a base object is consulted. The identity of this base object
          is as follows:
        </p>
        <dl>
          <dt>
            For <code>WebTiming</code> objects attached to
            <code>WebAnimationInstance</code> objects,
          </dt>
          <dd>
            Use <code>animation.timing</code>.
          </dd>
          <dt>
            Otherwise,
          </dt>
          <dd>
            Use the <var>global default <code>WebTiming</code> object</var>.
          </dd>
        </dl>
        <p>
          The <var>global default <code>WebTiming</code> object</var> is
          a <code>WebTiming</code> object where each property value is set to
          its <var>default value</var>.
        </p>
        <p>
          When querying the properties of a <code>WebTiming</code> the
          <var>effective value</var> of the property is resolved by looking up
          the base object. This is represented graphically below:
        </p>
        <div class="figure">
          <object data="img/webtiming-interaction.svg" width="600"></object>
        </div>
        <p class="caption">
          The values returned when querying <var>instance</var> are derived by
          successively querying base objects along the chain.
        </p>
        <section>
          <h3>The <code>WebTiming</code> interface</h3>
          <dl title="interface WebTiming" class="idl">
            <dt>const unsigned short WEBA_FILL_NONE = 0</dt>
            <dd>
              No fill.
            </dd>
            <dt>const unsigned short WEBA_FILL_FORWARDS = 1</dt>
            <dd>
              Fill forwards (=<code>fill="freeze"</code> in SVG speak).
            </dd>
            <dt>const unsigned short WEBA_FILL_BACKWARDS = 2</dt>
            <dd>
              Fill backwards.
            </dd>
            <dt>const unsigned short WEBA_FILL_BOTH = 3</dt>
            <dd>
              Fill backwards and forwards.
            </dd>
            <dt>const unsigned short WEBA_DIRECTION_NORMAL = 0</dt>
            <dd>
              All iterations are played as specified.
            </dd>
            <dt>const unsigned short WEBA_DIRECTION_REVERSE = 1</dt>
            <dd>
              All iterations are played in the reverse direction from the way
              they were specified.
            </dd>
            <dt>const unsigned short WEBA_DIRECTION_ALTERNATE = 2</dt>
            <dd>
              Even iterations are played as specified, odd iterations are played
              in the reverse direction from the way they were specified.
            </dd>
            <dt>const unsigned short WEBA_DIRECTION_ALTERNATE_REVERSE = 3</dt>
            <dd>
              Even iterations are played in the reverse direction from the way
              they were specified, odd iterations are played as specified.
            </dd>
            <dt>attribute float startDelay</dt>
            <dd>
              <p>
                The number of seconds from <code>startTime</code> until the
                timed item should begin executing.
              </p>
              <p>
                The <var>default value</var> is 0.
              </p>
            </dd>
            <dt>attribute unrestricted float? duration</dt>
            <dd>
              <p>
                The duration specified for a single iteration. This may be
                <code>null</code> in which case the intrinsic duration will be
                used. If set, it must be greater than or equal to zero
                (including positive infinity).
              </p>
              <p>
                The <var>default value</var> is <code>null</code>.
              </p>
            </dd>
            <dt>attribute unrestricted float iterationCount</dt>
            <dd>
              <p>
                A real number greater than or equal to zero (including positive
                infinite) representing the number of times to repeat the
                animation.
              </p>
              <p>
                The <var>default value</var> is 1.
              </p>
            </dd>
            <dt>attribute unsigned short direction</dt>
            <dd>
              <p>
                Direction behavior as specified by on of the
                <code>WEBA_DIRECTION_*</code> constants defined in this
                interface.
              </p>
              <p>
                The <var>default value</var> is
                <code>WEBA_DIRECTION_NORMAL</code>.
              </p>
            </dd>
            <dt>attribute WebTimingFunction timingFunction</dt>
            <dd class="todo">
              TBD.
            </dd>
            <dt>attribute unsigned short fill</dt>
            <dd>
              <p>
                Fill mode as specified by one of the <code>WEBA_FILL_*</code>
                constants defined in this interface.
              </p>
              <p>
                The <var>default value</var> is <code>WEBA_FILL_NONE</code>.
              </p>
            </dd>
          </dl>
        </section>
      </section>
      <section>
        <h3>The <code>WebTimedItem</code> interface</h3>
        <p>
          Represents the timing properties and methods of an animation actor:
          either a <a>WebAnimationInstance</a> or a <a>WebTimelineInstance</a>.
        </p>
        <dl title="interface WebTimedItem" class="idl">
          <dt>readonly attribute WebTiming timing</dt>
          <dd>
            The timing parameters for this item.
          </dd>
          <dt>readonly attribute unrestricted float simpleDuration</dt>
          <dd>
            The simple duration calculated for this item. If
            <code>timing.duration</code> is set and greater than or equal to
            zero, this will match <code>timing.duration</code>. Otherwise,
            this will reflect the calculated intrinsic duration of the item as
            described in <a href="#calculating-the-simple-duration"
              class="sectionRef"></a>.
          </dd>
          <dt>readonly attribute float? animationDuration</dt>
          <dd>
            The amount of time in seconds the animation is schedule to animate
            as described in <a href="#calculating-the-animation-duration"
              class="sectionRef"></a>.
          </dd>
          <dt>readonly attribute unsigned long? currentIteration</dt>
          <dd>
            The number of iterations that have completed as described in <a
              href="#calculating-the-current-iteration" class="sectionRef"></a>.
          </dd>
          <dt>attribute float startTime</dt>
          <dd>
            The time at which the animation becomes active expressed in
            seconds relative to the parent animation group.
            <span class="todo">Need to define what happens when you change
              this for an animation in flight. Maybe it should be
              read-only?</span>
          </dd>
          <dt>readonly attribute float endTime</dt>
          <dd>
            The time at which the animation ceases to be active expressed in
            seconds relative to the parent animation group.
          </dd>
          <dt>readonly attribute unrestricted float? simpleTime</dt>
          <dd>
            The time in seconds representing the offset into the simple
            duration using the steps described in <a
              href="#calculating-the-simple-time" class="sectionRef"></a>. As
            a result of that definition, this property will be
            non-<code>null</code> only when the animation is affecting its
            target.
          </dd>
          <dt>readonly attribute float? animationTime</dt>
          <dd>
            The time in seconds representing the offset into the animation
            phase. It is calculated using the steps described in <a
              href="#calculating-the-animation-time" class="sectionRef"></a>. As
            a result of that definition, this property will be
            non-<code>null</code> if and only if the animation is in the
            animating phase.
          </dd>
          <dt>readonly attribute WebTimeline parentTimeline</dt>
          <dd>
            The parent animation group
          </dd>
          <dt>void setPauseState (bool pauseState)</dt>
          <dd>
            Sets the pause state of this timed item.
            <span class="todo">Need to define how this works somewhere. e.g.
              for sequence containers, you just keep playing and then get
              stuck when you hit a paused one I guess. Also, need to define
              the interaction with <code>seek</code>.</span>
          </dd>
          <dt>bool getPauseState ()</dt>
          <dd>
            Retrusn the pause state of this timed item. Note that even if this
            returns false, the timed item might still be effectively paused by
            an ancestor animation group.
          </dd>
          <dt>bool isPaused ()</dt>
          <dd>
            Returns <code>true</code> if the pause state of this
            object <em>or one of its ancestor animation groups</em> is
            <code>true</code>.
          </dd>
          <dt>void seek (unsigned long activeTime)</dt>
          <dd>
            <span class="todo">TBD</span>
          </dd>
          <dt>void cancel ()</dt>
          <dd>
            Terminates the item and all its descendents such that they become
            inactive. Currently active items will have their
            <code>endTime</code> set to the current time of their parent
            group.
          </dd>
        </dl>
        <div class="feedbackWanted">
          How about a <code>reverse</code> method? What it does is call
          <code>cancel</code> on the timed item. Then it generates a clone with
          the <code>startTime</code> set to the current time. Then it sets the
          <code>direction</code> to its opposite (i.e. normal&#x2194;reverse,
          alternate&#x2194;alternate-reverse) and returns the new timed item?
        </div>
        <div class="todo">
          <p>
            Similar to <code>cancel</code>, do we want a method to terminate and
            then remove an item from its parent group? It seems like that's what
            you want to do for interactive stuff, UI stuff etc. That way you
            don't need to worry about removing those animations on a backwards
            seek?</span>
          </p>
          <p>
            Probably want methods for getting the startTime etc. in document
            time (i.e. in terms of the root time container). Or is it ok just to
            have a method on the parent animation group you pass your time to
            and it does the conversion? Note that the conversion is not
            necessarily as trivial as it seems if the parent animation group is
            paused.
          </p>
        </div>
      </section>
      <p>
        Need to add:
        <ul>
          <li>Pre-defined timing functions, spline-based timing functions etc.
          (want to allow a series of splines, not just four points)</li>
          <li>Custom easing functions</li>
          <li>Reversing</li>
          <li>Speed control (only belongs on containers?)</li>
        </ul>
      </p>
    </section>

    <section>
      <h2>Grouping and synchronization</h2>
      <p>
        Describe basic properties: can be seeked etc.
      </p>
      <p>
        Describe different types: par, seq, mediagroup. Do we need a concept of
        "effective start time" for seq?
      </p>
      <p>
        Describe how repetition works.
      </p>
      <p>
        Need to define "animation group time". I think this is probably the same
        as the <code>startTime</code> member of the <a>WebTimedItem</a>
        interface. Since, if you add a delay to an animation group, its
        intuitive that zero-time for that group is when the delay finishes (or
        does the group behave as if it is paused for the delay? i.e. the
        animation group time is zero at the start of the delay and at the end?)
      </p>
      <p>
        Integration with <code>&lt;video&gt;</code> etc.
      </p>
      <p>
        Describe how the document timeline is just a timeline instance with the
        following special properties:
      </p>
      <ul>
        <li>It cannot be appended as a child of another group. As a result the
        <code>parentTimeline</code> property returns <code>null</code>.</li>
        <li>A lot of other properties are read-only like
        <code>iterationCount</code> etc.</li>
        <li>It's startTime represents real-world time??? Can we align with the
        timestamps used in DOM (e.g. for events) here?</li>
      </ul>
      <section>
        <h3>Calculating the intrinsic duration of a timeline instance</h3>
        <dl class="switch">
          <dt>If the type is parallel,</dt>
          <dd>
            calc the endTime for each child and take the
            max. If any child has dur of type "parentEnd" skip it.
          </dd>
          <dt>If the type is sequence</dt>
          <dd>
            If it's seq, sum all the active durations + start delays
            (including negatives). If any child has a dur of parentEnd,
            treat it as zero and ignore the start delay???
          </dd>
          <dt>If the type is media group</dt>
          <dd>
            Same as parallel?
          </dd>
        </dl>
      </section>
      <section>
        <h3>The <code>WebTimelineInstance</code> interface</h3>
        <p>
          Represents a list of timed items which may be animation instances or
          nested timeline instances. Order is significant only when
          <code>type</code> is <code>WEBA_SYNC_SEQ</code>.
        </p>
        <div class="feedbackWanted">
          <p>
            For adding and removing items this interface relies on passing in
            actual <a>WebTimedItem</a> objects. This is similar to the Element
            interface but differs from many SVG interfaces which use numeric
            indices instead.
          </p>
          <p>
            Using objects instead of indices is generally more useful since,
            even if you only know the index you can easily convert it to an
            object (e.g. <code>remove(group.getItem(2))</code>) but the reverse
            conversion is more difficult. However, there are performance costs
            associated with creating these objects in situations where indices
            are sufficient.
          </p>
          <p>
            With the interface defined below, it's really hard to (a) remove and
            re-add an item in the same place, (b) move an item forward one
            place. DOM doesn't have this problem because it has
            <code>nextSibling</code> and co. The SVG interfaces also don't have
            this problem because they use indexes but they <em>do</em> have
            the problem that working with a passed in object is very difficult
            (because you don't know its index). Maybe we need nextSibling? Or
            something to take an item and find its index?
          </p>
          <p>
            Also, the use of exceptions below is perhaps a little inconsistent.
            I've used exceptions for cases which are exceptional. For
            <code>item</code> I think it's reasonable to return null (like
            <code>NodeList</code>). Likewise, for <code>remove</code> I think
            it's useful to just return <code>null</code> rather than throwing
            an exception (e.g. if it has already been removed / not yet added).
            Maybe you really want to return null if it has no parent and throw
            an exception if it belongs to another group?
          </p>
        </div>
        <div class="feedbackWanted">
          <p>
            The naming of all these objects deserves further consideration. We
            currently have:
          </p>
          <ul>
            <li><code>WebAnimationInstance</code></li>
            <li><code>WebAnimation</code></li>
            <li><code>WebTimelineInstance</code></li>
            <li><code>WebTimeline</code></li>
          </ul>
          <p>
            Some alternatives:
          </p>
          <ul>
            <li><code>WebAnimationInstance</code></li>
            <li><code>WebAnimation</code></li>
            <li><code>WebAnimationGroupInstance</code></li>
            <li><code>WebAnimationGroup</code></li>
          </ul>
          <ul>
            <li><code>WebAnimation</code></li>
            <li><code>WebAnimationDef</code></li>
            <li><code>WebTimeline</code></li>
            <li><code>WebTimelineDef</code></li>
          </ul>
          <ul>
            <li><code>WebAnimation</code></li>
            <li><code>WebAnimator</code></li>
            <li><code>WebAnimationGroup</code></li>
            <li><code>WebAnimatorGroup</code></li>
          </ul>
        </div>
        <dl title="[Constructor] interface WebTimelineInstance : WebTimedItem"
          class="idl">
          <dt>const unsigned short WEBA_SYNC_PAR = 0</dt>
          <dd>
            Parallel synchronization.
          </dd>
          <dt>const unsigned short WEBA_SYNC_SEQ = 1</dt>
          <dd>
            Sequence synchronization.
          </dd>
          <dt>const unsigned short WEBA_SYNC_MEDIA = 2</dt>
          <dd>
            Media group synchronization.
          </dd>
          <dt>readonly attribute unsigned long length</dt>
          <dd>
            The number of timed items in the group.
          </dd>
          <dt>attribute unsigned short type</dt>
          <dd>
            <p>
              The type of synchronization provided by this timeline instance
              as specified by one of the <code>WEBA_SYNC_*</code> constants
              defined in this interface.
            </p>
            <p>
              Setting this value has the following effect:
            </p>
            <ol>
              <li>
                If <code>type</code> is set to the same value as the previous
                value return.
              </li>
              <li>
                Record the current container time.
              </li>
              <li>
                For each child in the group, call <code>cancel</code>.
              </li>
              <li>
                Seek the container time to zero.
              </li>
              <li>
                Calculate the effective start time of each child in the timeline
                instance using the new synchronization type <span
                class="todo">(Need a cross-reference to somewhere where we
                describe this behaviour and define things like "effective
                start time".)</span>
              </li>
              <li>
                Seek the container time to the previously recorded time.
              </li>
            </ol>
            <p class="feedbackWanted">
              Note that a consequence of the above is that, for example, if you
              change a container from type <code>par</code> to
              <code>mediaGroup</code> you could potentially generate a lot of
              end events followed by a lot of begin events despite the fact that
              the animation might not produce any different visual result. We
              could change the behaviour so that it effectively records the
              play state of each item before and then after the "seek"
              dispatches the appropriate events.
            </p>
          </dd>
          <dt>void clear ()</dt>
          <dd>
            Removes all child timed items from the group.
          </dd>
          <dt>WebTimedItem append (WebTimedItem newItem)</dt>
          <dd>
            Add <code>newItem</code> as the last item in the group. If
            <code>newItem</code> already belongs to a group (including this
            group) it will first be removed from that group before being added
            to this group. Returns <code>newItem</code>.
          </dd>
          <dt>WebTimedItem insertBefore (WebTimedItem newItem,
            WebTimedItem? refItem)</dt>
          <dd>
            <p>
              Inserts <code>newItem</code> before the existing
              <code>refItem</code>. If <code>refItem</code> is null,
              <code>newChild</code> is added to the end of the list. If
              <code>newItem</code> already belongs to a group (including this
              group) it will first be removed from that group before being added
              to this group. If <code>newItem</code> and <code>refItem</code>
              are the same object then no change is made. Returns
              <code>newItem</code>.
            </p>
            <p class="feedbackWanted">
              What events are fired? If <code>newChild</code> is removed from
              a group then fire end event?
            </p>
            <p>Exceptions:</p>
            <ul>
              <li>HIERARCHY_REQUEST_ERR: Raised if <code>newItem</code> is
              a root animation group for a document <span class="todo">(need
              cross-ref here)</span>.</li>
              <li>NOT_FOUND_ERR: Raised if <code>refItem</code> is not a child
              of this group.</li>
            </ul>
          </dd>
          <dt>WebTimedItem? item (unsigned long index)</dt>
          <dd>
            Returns the item at <code>index</code>. If <code>index</code> is
            greater than or equal to <code>length</code> returns
            <code>null</code>. Equivalent to
            <code>WebAnimationGroup[index]</code>. <span class="todo">(Need to
            work out how to define this behavior&mdash;i.e. that you can use the
            subscript operator)</span>
          </dd>
          <dt>WebTimedItem? remove (WebTimedItem removedItem)</dt>
          <dd>
            Removes <code>removedItem</code> from the group and returns it. If
            <code>removedItem</code> is not part of this group, returns
            <code>null</code>.
          </dd>
          <dt>sequence&lt;WebAnimation&gt; getActiveAnimations ()</dt>
          <dd>
            Returns all descendent WebAnimation objects that are active. The
            returned sequence is a snapshot (i.e. not live) representing the
            state of animations at the time returned by the
            <code>currentTime</code> property of this WebAnimationGroup object
            when this method was called.
          </dd>
          <dt>sequence&lt;WebAnimation&gt; getAnimationsForElement (Element
            elem)</dt>
          <dd>
            Returns all descendent WebAnimation objects whose
            <code>targetElement</code> is <code>elem</code>. As with
            <code>getActiveAnimations</code>, the returned sequence is
            a snapshot (i.e. not live) representing the state of the animation
            tree when this method was called. <span class="todo">(Need to define
            "animation tree" or find another word?)</span>
          </dd>
        </dl>
      </section>
    </section>

    <section>
      <h2>Animation values</h2>
      <section>
        <h3>Animation fill behavior</h3>
      </section>
      <section>
        <h3>The <code>WebAnimationFunction</code> interface</h3>
        <div class="todo">
          <p>
            This should probably become a superclass from which we create
            <code>WebKeyframesFunction</code> and
            <code>WebTwoValuedFunction</code>. It seems like it might even be
            useful to allow script to provide its own function. I'm not sure how
            that works exactly, but if we were to support that, then the
            interface would be something like:
          </p>
          <ul>
            <li><code>Sample(float simpleProgress, Element target, any
              underlyingValue)</code> (where <code>simpleProgress</code> is the
            ratio of <var>simple time</var> to <var>simple duration</var>)</li>
          </ul>
          <p>
            Implementations of the function would be expected to produce the
            same result given the same parameters so the implementation could
            cache the result and not call the function when the parameters were
            the same.
          </p>
          <p>
            That would potentially let you animate anything.
          </p>
        </div>
        <p>
          I think most of the members of the interface, perhaps all, should be
          readonly when this object is returned from
          a <code>WebAnimationInstance</code> object. Objects returned from
          a <code>WebAnimation</code>, however, are live.
        </p>
        <p>
          <dl title="[Constructor] interface WebAnimationFunction" class="idl">
            <dt>attribute DOMString property</dt>
            <dd>
              The target attribute / property. <code>property</code> is probably
              a reserved word we should avoid though.
            </dd>
            <dt>attribute WebAnimationFrameList frames</dt>
            <dd>
              The series of values that make up this function sorted by their
              offset within the simple duration of the animation.
            </dd>
            <dt>attribute unsigned short additive</dt>
            <dd>
              This depends how addition works
            </dd>
            <dt>attribute unsigned short accumulate</dt>
            <dd>
              This also depends how addition works
            </dd>
            <dt>attribute DOMString? pace</dt>
            <dd>
              This is just a placeholder for some kind of <i>whole-animation
              -function</i> timing control. For example, SVG has
              <code>calcMode="paced"</code> which looks at all the frames in the
              animation and adjusts the timing so the pace of change is
              constant (this is especially useful for motion on a path).<br>
              The example here could take values <code>null</code> (default),
              "auto", or something like "1px/s" (not sure what the datatype
              should be here). Not sure yet how this will work with adaptive
              duration if other animation functions use also this.
            </dd>
            <dt>WebAnimationFunction clone ()</dt>
            <dd>
              Returns a copy of this object.
              <span class="todo">As with
              <code>WebAnimationFunctionCollection</code> this only exists so
              functions can be changed in flight</span>
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFunctionCollection</code> interface</h3>
        <p>
          Yeah, the name is a mouthful, but like <code>HTMLCollection</code> you
          rarely use this directly. I'm not sure if &lsquo;collection&rsquo; is
          the right terminology. It's basically an unordered list.
          <dl title="[Constructor] interface WebAnimationFunctionCollection"
            class="idl">
            <dt>readonly attribute unsigned long length</dt>
            <dd>
              The number of functions in the collection.
            </dd>
            <dt>WebAnimationFunction? item(unsigned long index)</dt>
            <dd>
              Gets the function at <code>index</code> if it exists. We only
              have this so you can enumerate the list. But the danger is then
              apps start to assume the list is in a certain order. So wherever
              we use this we really should define that order.
            </dd>
            <dt>WebAnimationFunction? namedItem(DOMString propertyName)</dt>
            <dd>
              Returns the <code>WebAnimationFunction</code> with
              <code>property</code> = <code>propertyName</code> or null
              otherwise. 
            </dd>
            <dt>WebAnimationFunction add(WebAnimationFunction function)</dt>
            <dd>
              Adds <code>function</code> to the collection. If there is already
              a function in the collection targetting the same property (do we
              compare properties in a case-insensitive manner? After stripping
              whitespace?) it will be removed before this is added. If
              <code>function</code> already exists in this collection no change
              will be made?? Does that break assumptions about order though? We
              could just say it will be moved to the end of the list
            </dd>
            <dt>WebAnimationFunctionCollection clone ()</td>
            <dd>
              Creates a copy of this object and the
              <code>WebAnimationFunction</code> objects it contains.
              <span class="todo">This only exists so functions can be changed in
              flight by cloning the function collection attached to an animation
              and then attaching the clone to the instance. How important is
              that though?</span>
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFrame</code> interface</h3>
        <p>
          <dl title="[Constructor] interface WebAnimationFrame" class="idl">
            <dt>attribute any value</dt>
            <dd>
              The attribute / property value for the given frame
            </dd>
            <dt>attribute float offset</dt>
            <dd>
              A value between 0 and 1 (inclusive) representing the offset within
              the simple duration of the animation where this value should
              appear. Ignored if we're using paced timing?<br>
              What happens if you change it? The array returned by the
              <code>WebAnimationFunction</code> is updated? I guess that's fine
              if it's just an array. Any already-returned arrays wouldn't need
              to be updated.<br>
              What happens if you have two values with the same offset? It would
              be nice if the result was deterministic rather than just left up
              in the air (since the more you leave undefined, the more you let
              the Web define it for you).
            </dd>
            <dt>attribute WebTimingFunction timingFunction</dt>
            <dd>
              The function to use for this segment. Would a string do here? E.g.
              "ease" or "cubic-bezier(1 0 0.3 1)"? Probably not. It's a little
              too CSS-specific for a start, and we want to allow this to
              potentially be a function pointer.<br>
              Ignored if we're using paced timing
            </dd>
          </dl>
        </p>
      </section>
      <section>
        <h3>The <code>WebAnimationFrameList</code> interface</h3>
        <dl title="interface WebAnimationFrameList" class="idl">
          <dt>readonly attribute unsigned long length</dt>
          <dd>
            The number of frames in the list.
          </dd>
          <dt>WebAnimationFrameList? item(unsigned long index)</dt>
          <dd>
            Returns the frame at <code>index</code> if it exists or null.
          </dd>
          <dt>WebAnimationFrameList? add(WebAnimationFrame frame)</dt>
          <dd>
            Adds <code>frame</code> to the list such that the list is sorted
            by the offset of the frames. If there's already a frame with the
            same offset? This one comes after?
          </dd>
          <dt>WebAnimationFrameList? remove(unsigned long index)</dt>
          <dd>
            Adds <code>frame</code> to the list such that the list is sorted
            by the offset of the frames. If there's already a frame with the
            same offset? This one comes after?
          </dd>
        </dl>
        <p>
          Not sure about the <code>remove</code> method. Do we want:
          <ul>
            <li><code>remove(WebAnimationFrame frame)</code>?</li>
            <li><code>removeAtOffset(unsigned long offset)</code>?</li>
            <li><code>itemAtOffset(unsigned long offset)</code>?</li>
          </ul>
        </p>
      </section>
      <p>
        Need to add:
        <ul>
          <li>Pre-defined timing functions, spline-based timing functions etc.
          (want to allow a series of splines, not just four points)</li>
          <li>Custom easing functions</li>
          <li>Pace control (e.g. <code>pace="10px/s"</code>?)</li>
          <li>Motion on a path</li>
          <li>General functional syntax</li>
          <li>&lsquo;to&rsquo; animation</li>
        </ul>
      </p>
      <p>
        Somewhere we need to describe how animated values get stored in the DOM.
        i.e. can you access them at all? what's the interaction with various
        override stylesheets etc.
      </p>
      <p>
        Need to add a way for getting animation values of motion-on-a-path
        animations
      </p>
    </section>

    <section>
      <h2>Combining animations</h2>
      <p>
        Animation addition
      </p>
    </section>

    <section>
      <h2>Synchronizing with media</h2>
      <section>
        <h3>The intrinsic duration of a media item</h3>
        <p class="todo">
          Basically just take the <code>HTMLMediaElement.duration</code>
          property. Possibly convert <code>NaN</code> values to positive
          infinity.
        </p>
      </section>
      <section>
        <h3>The <code>WebMediaItem</code> interface</h3>
        <dl title="interface WebMediaItem" class="idl">
          <dt>attribute HTMLMediaElement element</dt>
          <dd>
            A pointer to the element?
          </dd>
        </dl>
      </section>
    </section>

    <section>
      <h2>Animation state</h2>
      <p>
        State machines
      </p>
    </section>

    <section>
      <h2>Animation events</h2>
      <p>
        Need to consider how to align with existing
        <code>TransitionEvent</code>s, <code>AnimationEvent</code>s and
        <code>TimeEvent</code>s. It might make sense to have our events inherit
        from one or more of these interfaces or have implementations dispatch
        both (especially if their synchronization properties differ).
      </p>
      <p>
        I think we might also want a seek event? It seems like a lot of
        applications will want to do bookkeeping when there's
        a seek&mdash;especially a backwards seek. It might also be necessary for
        the SVG bindings so you can clear certain events on a backwards seek as
        required by SMIL.
      </p>
      <section>
        <h3>Synchronizing event handlers</h3>
        <p>
          Your text...
        </p>
      </section>
    </section>

    <section>
      <h2>Extensions to Document interfaces</h2>
      <p>
        Since the document acts as a root animation group user agents MUST add
        an <code>animationRoot</code> member to the document interface for each
        document type where animation is supported. For example, HTMLDocument
        and SVGDocument.
      </p>
      <p>
        The definition of this member is given below.
      </p>
      <dl title="partial interface HTMLDocument" class="idl">
        <dt>readonly attribute WebAnimationGroup animationRoot</dt>
        <dd>
          The animation group corresponding to the root of the document. This
          group exhibits the special behaviour described for a root animation
          group in
          <a href="#grouping-and-synchronization" class="sectionRef"></a>.
        </dd>
      </dl>
    </section>

    <section>
      <h2>Animation of common data types</h2>
      <p>
        Need to describe how to interpolate/add both:
        <ol>
          <li>Integers, floats, strings etc.</li>
          <li>CSS and SVG types (colors etc.)</li>
          <ul><li>Support for HSL (if the colors are specified in HSL we should
            interpolate in that notation; but it should also be possible to
            do so regardless of how the colors are specified)</li></ul>
        </ol>
      </p>
      <p>
        For transforms I think it's defined elsewhere so we can either just
        point to that spec, or just refer to the fact that other specs should
        define how their types should be supported (or not) for animation.
      </p>
      <p>
        Need to provide facility for smooth interpolation of arbitrary paths.
      </p>
    </section>

    <section>
      <h2>Animation style</h2>
      <section>
        <h3>The <code>transition-*</code> properties</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>animation-*</code> properties</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>CSSAnimation</code> interface</h3>
        <p>
          <dl title="interface CSSAnimation: WebAnimation"
            class="idl">
          </dl>
        </p>
      </section>
      <section>
        <h3>Querying the animated style</h3>
        <p>
          Need to describe <code>window.getAnimatedStyle(DOMString
            selector)</code> here.
        </p>
      </section>
    </section>

    <section>
      <h2>Animation elements</h2>
      <section>
        <h3>The <code>&lsquo;animate&rsquo;</code> element</h3>
        <p>
          Your text...
        </p>
      </section>
      <section>
        <h3>The <code>&lsquo;set&rsquo;</code> element</h3>
        <p>
          Your text...
        </p>
        <p>
          The <code>&lsquo;animateColor&rsquo;</code> and
          <code>&lsquo;animateTransform&rsquo;</code> elements are deprecated.
          Can we get rid of <code>&lsquo;animateMotion&rsquo;</code> too?
        </p>
      </section>
      <section>
        <h3>The <code>SVGAnimationElement</code> interface</h3>
        <p>
          <dl title="interface SVGAnimationElement : WebAnimation"
            class="idl">
          </dl>
        </p>
        <p>
          Need to describe how to set up named animations using these elements.
        </p>
      </section>
    </section>

    <section>
      <h2>Making animation accessible</h2>
      <p>
        Describe how to integrate with the <a
          href="http://www.whatwg.org/specs/web-apps/current-work/#timed-text-tracks">Timed
          Text API</a> and give examples of how to author content so it is
        accessible.
      </p>
    </section>
    <section class='appendix'>
      <h2>Acknowledgements</h2>
    </section>
  </body>
</html>
